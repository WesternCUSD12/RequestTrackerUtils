{% extends 'base.html' %}

{% block title %}Batch Labels{% endblock %}

{% block styles %}
{{ super() }}
<style>
  /* Hide unnecessary elements when printing */
  @media print {
    .navbar, .no-print, .batch-controls, footer {
      display: none !important;
    }
    body {
      margin: 0;
      padding: 0;
    }
  }
  
  /* Label styles */
  .label-container {
    width: 100%;
    padding: 0;
    margin: 0;
    page-break-inside: avoid;
    page-break-after: always;
  }
  
  /* The last label doesn't need a page break after it */
  .label-container:last-child {
    page-break-after: auto;
  }
  
  .asset-label {
    border: 1px solid #ccc;
    padding: 10px;
    margin: 10px 0;
    width: 100%;
    max-width: 100mm;
    height: 62mm;
    position: relative;
    background-color: white;
    box-sizing: border-box;
  }
  
  .label-section {
    margin-bottom: 5px;
  }
  
  .asset-name {
    font-weight: bold;
    font-size: 16px;
  }
  
  .asset-description {
    font-size: 12px;
    font-style: italic;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .label-field {
    font-size: 12px;
    margin: 2px 0;
  }
  
  .label-field strong {
    font-weight: bold;
  }
  
  .qr-container {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 80px;
    height: 80px;
  }
  
  .qr-code {
    width: 100%;
  }
  
  .barcode-container {
    width: 100%;
    text-align: center;
    margin-top: 10px;
  }
  
  .barcode {
    max-width: 90%;
    height: 40px;
  }
  
  /* Batch controls panel */
  .batch-controls {
    background-color: #f8f9fa;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
    position: sticky;
    top: 0;
    z-index: 100;
  }
</style>
{% endblock %}

{% block content %}
<div class="batch-controls no-print">
  <div class="row align-items-center">
    <div class="col-md-6">
      <h2>Batch Labels ({{ labels|length }} assets)</h2>
      {% if warning %}
      <div class="alert alert-warning">{{ warning }}</div>
      {% endif %}
    </div>
    <div class="col-md-6 text-end">
      <a href="{{ url_for('label_routes.batch_labels') }}" class="btn btn-secondary me-2">Back to Query</a>
      <button onclick="window.print();" class="btn btn-primary">Print Labels</button>
    </div>
  </div>
</div>

{% for label in labels %}
<div class="label-container">
  <div class="asset-label" style="width: {{ label.label_width }}mm; height: {{ label.label_height }}mm;">
    <div class="label-section">
      <div class="asset-name">{{ label.name }}</div>
      <div class="asset-description">{{ label.description }}</div>
    </div>
    
    <div class="label-section">
      <div class="label-field"><strong>S/N:</strong> {{ label.serial_number }}</div>
      <div class="label-field"><strong>Model:</strong> {{ label.model_number }}</div>
      {% if label.internal_name != "N/A" %}
      <div class="label-field"><strong>Internal Name:</strong> {{ label.internal_name }}</div>
      {% endif %}
      {% if label.funding_source != "N/A" %}
      <div class="label-field"><strong>Funding:</strong> {{ label.funding_source }}</div>
      {% endif %}
    </div>
    
    <div class="qr-container">
      <img src="data:image/png;base64,{{ label.qr_code }}" alt="QR Code" class="qr-code">
    </div>
    
    <div class="barcode-container">
      <img src="data:image/png;base64,{{ label.barcode }}" alt="Barcode" class="barcode">
    </div>
  </div>
</div>
{% endfor %}

<div class="batch-controls no-print mt-3">
  <div class="text-center">
    <p>Generated {{ labels|length }} labels. Use your browser's print function to print them.</p>
    <button onclick="window.print();" class="btn btn-primary">Print Labels</button>
    <a href="{{ url_for('label_routes.batch_labels') }}" class="btn btn-secondary">Back to Query</a>
  </div>
</div>
{% endblock %}